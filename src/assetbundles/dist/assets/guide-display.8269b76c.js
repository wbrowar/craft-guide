import{d as G,r as d,a as R,c as b,o as P,b as L,e as q,w as M,n as B,_ as k,f as F,g as v,t as C,u as f,h as O,i as V,j as $,k as h,l as U}from"./_plugin-vue_export-helper.007b8a71.js";import{l as _,p as x,g as T,t as E,u as J,e as j}from"./guide.d4fc2305.js";import{C as z,G as H,S as K,a as Q}from"./SvgSettings.3d313eba.js";const W=G({__name:"GuideDisplay",props:{enableInlineEditor:Boolean,guideDisplay:{type:String,required:!0},guideNavData:String,startInInlineEditor:{type:Boolean,required:!1},teleportContainerClass:{type:String,default:""},teleportMethod:{type:String,default:"append"},teleportSelector:String,teleportToSlideout:{type:Boolean,default:!1}},setup(u){const e=u,a=d(""),l=R({}),c=d(!1),g=d(""),o=d(!1),p=d(!1),m=d(),N=d(!1),S=b(()=>e.guideNavData?JSON.parse(e.guideNavData):[]);b(()=>e.teleportToSlideout?N.value:!0),b(()=>e.teleportToSlideout&&e.teleportSelector?e.teleportSelector:e.teleportSelector?`#teleport-${e.guideDisplay}`:null);function n(){g.value=window.location.hash.substr(1)}function i(t){_(`Turning TLDR: ${t?"on":"off"}`),p.value=t===!0,document.querySelectorAll(".tldr-show").forEach(r=>{t?r.removeAttribute("hidden"):r.setAttribute("hidden","hidden")}),document.querySelectorAll(".tldr-hide").forEach(r=>{t?r.setAttribute("hidden","hidden"):r.removeAttribute("hidden")}),localStorage.setItem("guide:display:tldr",t?"true":"false")}function s(){if(a.value){const t=document.querySelector(`.guide-${a.value} .tldr-hide, .guide-${a.value} .tldr-show, .guide-${a.value} [class^="tldr:"]`);c.value=t!==null}}return P(()=>{var t;(t=S.value)!=null&&t.length&&(a.value=S.value[0].slug),o.value=e.startInInlineEditor===!0}),L(()=>{var t;s(),i(localStorage.getItem("guide:display:tldr")==="true"),window.addEventListener("hashchange",n),e.teleportToSlideout&&((t=window.Craft)==null?void 0:t.Slideout)&&(m.value=new window.Craft.Slideout('<div id="guide-slideout"></div>',{autoOpen:!1,containerAttributes:{class:"g-relative g-overflow-y-auto"}})),_("GuideDisplay loaded")}),q(()=>{window.removeEventListener("hashchange",n)}),M(a,()=>{B(()=>{s(),i(p.value)})}),M(S,()=>{x&&S.value.forEach(t=>{l[t.slug]||(l[t.slug]={boolean1:!1,boolean2:!1,boolean3:!1,boolean4:!1,boolean5:!1,number1:0,number2:0,number3:0,number4:0,number5:0,string1:"",string2:"",string3:"",string4:"",string5:""})})},{immediate:!0}),()=>{}}});const A=k(W,[["__file","GuideDisplay.vue"]]),X=G({__name:"OnLoad",emits:["loaded"],setup(u,{emit:e}){return L(()=>{e("loaded")}),(a,l)=>F(a.$slots,"default")}}),Y=k(X,[["__file","OnLoad.vue"]]),Z={key:0},ee={key:0},te={key:0},ae={key:1},ne={key:1},le={key:0},oe={key:1},ie=G({__name:"PlacementInlineEditor",props:{placementId:String,placementInlineEditor:{type:String,required:!0}},setup(u){const e=u,a=d(),l=d(),c=d(!1),g=d(),o=b(()=>{const n=[{label:E["Select One"],value:"__none__"}];return T.forEach(i=>{n.push({label:i.title,value:i.slug})}),n});async function p(){var n,i;(n=l.value)!=null&&n.id&&await((i=window.Craft)==null?void 0:i.postActionRequest("guide/placement/delete-placement",{data:JSON.stringify(l.value)},(s,t,D)=>{var I,r,y,w;_("Deleting placement",s,t,D),c.value=!0,s.status==="success"?(r=(I=window.Craft)==null?void 0:I.cp)==null||r.displayNotice("Guide removed"):(w=(y=window.Craft)==null?void 0:y.cp)==null||w.displayError(s.data.error)}))}function m(n){a.value=n}function N(){a.value==="__none__"?p():S()}async function S(){var i;const n=T.find(s=>s.slug===a.value);l.value&&n&&(l.value.guideId=n.id),await((i=window.Craft)==null?void 0:i.postActionRequest("guide/placement/save-placement",{data:JSON.stringify(l.value)},(s,t,D)=>{var I,r,y,w;_("Saving placement",s,t,D),c.value=!0,s.status==="success"?(r=(I=window.Craft)==null?void 0:I.cp)==null||r.displayNotice("Guide UI element updated"):(w=(y=window.Craft)==null?void 0:y.cp)==null||w.displayError(s.data.error)}))}return P(()=>{l.value={access:"all",group:"uiElement",groupId:e.placementInlineEditor,guideId:null,id:e.placementId?parseFloat(e.placementId):null,portalMethod:"append",selector:null,theme:"default",uri:null}}),L(()=>{g.value&&g.value.setFieldValue(o.value[0].value),_("PlacementInlineEditor loaded")}),(n,i)=>u.placementInlineEditor?(h(),v("div",Z,[c.value?(h(),v("div",ee,[a.value==="__none__"?(h(),v("p",te,C(f(E).PLACEMENT_INLINE_EDITOR_CONFIRM_REMOVED),1)):(h(),v("p",ae,C(f(E).PLACEMENT_INLINE_EDITOR_CONFIRM_ADDED),1))])):O("",!0),!c.value&&f(J).useOrganizer?(h(),v("div",ne,[f(T).length?(h(),v("div",le,[V(z,{ref_key:"guideField",ref:g,instructions:f(E).PLACEMENT_INLINE_EDITOR_FIELD_INSTRUCTIONS_GUIDE,label:f(E).Guide,name:"guide",options:f(o),onValueChanged:m},null,8,["instructions","label","options"]),$("button",{class:"btn submit",type:"button",onClick:N},C(f(E).Save),1)])):(h(),v("div",oe,[$("p",null,C(f(E).PLACEMENT_INLINE_EDITOR_NO_GUIDES),1)]))])):O("",!0)])):O("",!0)}}),se=k(ie,[["__file","PlacementInlineEditor.vue"]]);function ce(){try{const u=document.querySelectorAll("[data-guide-display]");u&&u.forEach(e=>{var a,l,c,g;if((a=e.dataset)!=null&&a.guideDisplay){if((l=e.dataset)!=null&&l.teleportSelector){const p=document.querySelector(e.dataset.teleportSelector);if(p){const m=document.createElement("div");m.id=`teleport-${e.dataset.guideDisplay}`,(c=e.dataset)!=null&&c.teleportContainerClass&&m.setAttribute("class",e.dataset.teleportContainerClass),((g=e.dataset)==null?void 0:g.teleportMethod)==="prepend"?p.insertBefore(m,p.firstChild):p.appendChild(m)}}A.name="GuideDisplay",A.template=`#${e.dataset.guideDisplay}`;const o=U(A,e.dataset);_("Data set",{...e.dataset}),o.component("guide-modal",H),o.component("on-load",Y),o.component("placement-inline-editor",se),o.component("svg-guide",K),o.component("svg-settings",Q),o.config.compilerOptions.delimiters=["${","}"],o.config.globalProperties.$log=console.log,o.mount(e),_("Display mounted for",e.dataset)}}),_("Display loaded")}catch(u){j(u)}}export{ce as default};
