import{d as p,_ as f,r as v,e as S,y as u,l as b,u as _,I as w,o,c as r,b as h,B as y,a as E,p as C,Q as I}from"./_plugin-vue_export-helper-BeDxH-uk.js";import{C as $,S as G}from"./SvgSettings-CbWvJOWK.js";const N=p({emits:["loaded"],created(){this.$emit("loaded")}});function T(e,t,i,a,d,n){return null}const k=f(N,[["render",T]]),D=p({name:"PlacementInlineEditor",components:{CraftFieldSelect:$},props:{placementId:String,placementInlineEditor:{type:String,required:!0}},setup:e=>{const t=v({guides:b,guideValue:null,placement:null,placementSaved:!1,userOperations:_});return t.placement={access:"all",group:"uiElement",groupId:e.placementInlineEditor,guideId:null,id:parseFloat(e.placementId)||null,portalMethod:"append",selector:null,theme:"default",uri:null},{...S(t)}},computed:{guideFieldOptions(){const e=[{label:"Select One",value:"__none__"}];return this.guides.forEach(t=>{e.push({label:t.title,value:t.slug})}),e}},methods:{async deletePlacement(){var e,t;(e=this.placement)!=null&&e.id&&await((t=window.Craft)==null?void 0:t.postActionRequest("guide/placement/delete-placement",{data:JSON.stringify(this.placement)},(i,a,d)=>{var n,s,l,c;u("Deleting placement",i,a,d),this.placementSaved=!0,i.status==="success"?(s=(n=window.Craft)==null?void 0:n.cp)==null||s.displayNotice("Guide removed"):(c=(l=window.Craft)==null?void 0:l.cp)==null||c.displayError(i.data.error)}))},onGroupChanged(e){this.guideValue=e},onSaveClicked(){this.guideValue==="__none__"?this.deletePlacement():this.savePlacement()},async savePlacement(){var t;const e=this.guides.find(i=>i.slug===this.guideValue);e&&(this.placement.guideId=e.id),await((t=window.Craft)==null?void 0:t.postActionRequest("guide/placement/save-placement",{data:JSON.stringify(this.placement)},(i,a,d)=>{var n,s,l,c;u("Saving placement",i,a,d),this.placementSaved=!0,i.status==="success"?(s=(n=window.Craft)==null?void 0:n.cp)==null||s.displayNotice("Guide UI element updated"):(c=(l=window.Craft)==null?void 0:l.cp)==null||c.displayError(i.data.error)}))}},mounted(){this.$refs.guideField.setFieldValue(this.guideFieldOptions[0].value),u("PlacementInlineEditor loaded")}}),A={key:0},O={key:0},V={key:0},q={key:1},F={key:1},P={key:0},B={key:1},U=E("p",null,"No guides have been created yet. Create a guide and then return here to select it for this UI element.",-1),L=[U];function R(e,t,i,a,d,n){const s=w("CraftFieldSelect");return e.placementInlineEditor?(o(),r("div",A,[e.placementSaved?(o(),r("div",O,[e.guideValue==="__none__"?(o(),r("p",V,"Guide removed. Please reload this page and select another guide.")):(o(),r("p",q,"Guide added. Please reload this page to see the guide displayed here."))])):h("",!0),e.userOperations.useOrganizer?(o(),r("div",F,[e.guides.length?(o(),r("div",P,[y(s,{ref:"guideField",instructions:"Select a guide to be displayed here.",label:"Guide",name:"guide",options:e.guideFieldOptions,onValueChanged:e.onGroupChanged},null,8,["options","onValueChanged"]),E("button",{class:"btn submit",type:"button",onClick:t[0]||(t[0]=(...l)=>e.onSaveClicked&&e.onSaveClicked(...l))},"Save")])):(o(),r("div",B,L))])):h("",!0)])):h("",!0)}const H=f(D,[["render",R]]),g=p({name:"GuideDisplay",delimiters:["${","}"],components:{OnLoad:k,PlacementInlineEditor:H,SvgSettings:G},props:{enableInlineEditor:Boolean,guideDisplay:{type:String,required:!0},guideNavData:String,startInInlineEditor:{type:Boolean,required:!1},teleportContainerClass:String,teleportMethod:String,teleportSelector:String},setup:e=>{const t=v({currentGuide:"",data:{},guideNav:e.guideNavData?JSON.parse(e.guideNavData):[],hash:"",enableTldr:!1,proEdition:C,showInlineEditor:!1,showTldr:!1,userOperations:_});return t.proEdition&&t.guideNav.forEach(i=>{t.data[i.slug]={boolean1:!1,boolean2:!1,boolean3:!1,boolean4:!1,boolean5:!1,number1:0,number2:0,number3:0,number4:0,number5:0,string1:"",string2:"",string3:"",string4:"",string5:""}}),{...S(t)}},computed:{teleportTarget(){return this.teleportSelector?`#teleport-${this.guideDisplay}`:null}},methods:{onHashUpdated(){this.hash=window.location.hash.substr(1)},toggleTldr(e){u(`Turning TLDR: ${e?"on":"off"}`),this.showTldr=e,document.querySelectorAll(".tldr-show").forEach(a=>{e?a.removeAttribute("hidden"):a.setAttribute("hidden","hidden")}),document.querySelectorAll(".tldr-hide").forEach(a=>{e?a.setAttribute("hidden","hidden"):a.removeAttribute("hidden")}),localStorage.setItem("guide:display:tldr",e?"true":"false")},updateEnableTldr(){if(this.currentGuide){const e=document.querySelector(`.guide-${this.currentGuide} .tldr-hide, .guide-${this.currentGuide} .tldr-show, .guide-${this.currentGuide} [class^="tldr:"]`);u(`.guide-${this.currentGuide}`,e),this.enableTldr=e!==null}}},created(){var e;(e=this.guideNav)!=null&&e.length&&(this.currentGuide=this.guideNav[0].slug),this.showInlineEditor=this.startInInlineEditor},mounted(){this.updateEnableTldr(),this.toggleTldr(localStorage.getItem("guide:display:tldr")==="true"),window.addEventListener("hashchange",this.onHashUpdated),u("GuideDisplay loaded")},beforeUnmount(){window.removeEventListener("hashchange",this.onHashUpdated)},watch:{currentGuide(){this.$nextTick(()=>{this.updateEnableTldr(),this.toggleTldr(this.showTldr)})}}}),m=document.querySelectorAll("[data-guide-display]");m&&m.forEach(e=>{var t,i,a,d;if((t=e.dataset)!=null&&t.guideDisplay){if((i=e.dataset)!=null&&i.teleportSelector){const n=document.querySelector(e.dataset.teleportSelector);if(n){const s=document.createElement("div");s.id=`teleport-${e.dataset.guideDisplay}`,(a=e.dataset)!=null&&a.teleportContainerClass&&s.setAttribute("class",e.dataset.teleportContainerClass),((d=e.dataset)==null?void 0:d.teleportMethod)==="append"?n.appendChild(s):n.insertBefore(s,n.firstChild)}}g.template=`#${e.dataset.guideDisplay}`,I({...g},e.dataset).mount(e)}});
